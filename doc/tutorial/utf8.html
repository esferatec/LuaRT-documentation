<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="IE=edge" http-equiv="X-UA-Compatible" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="Lua utf8 strings tutorial" name="description" />
  <title>
    How to use UTF8 strings | LuaRT free and open source Windows programming framework for Lua
  </title>
  <link href="../../css/bulma-docs.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        rel="stylesheet" />
  <link href="https://luart.org/doc/tutorial/utf8.html" rel="canonical" />
  <link href="../../img/favicon.png" rel="icon" sizes="16x16" type="image/png" />
  <link rel="stylesheet" href="../prism.css" data-noprefix="">
</head>
<body class="layout-documentation has-navbar-fixed-top">
    <nav class="bd-navbar navbar is-fixed-top has-shadow" id="navbar">
        <div class="navbar-brand">
          <a class="navbar-item" href="https://luart.org/">
            <img alt="LuaRT: Free and open source Windows programming framework for Lua"
                 height="40"
                 src="../../img/logo.svg"
                 width="112" />
          </a>
          <a class="navbar-item bd-navbar-mobile-icon"
             href="https://github.com/samyeyo"
             style="margin-left: auto"
             target="_blank">
            <span class="icon" style="color: #000000">
              <i class="fab fa-lg fa-github"></i>
            </span>
          </a>
          <a class="navbar-item bd-navbar-mobile-icon"
             href="https://twitter.com/__LuaRT__"
             target="_blank">
            <span class="icon" style="color: #000000">
              <i class="fab fa-lg fa-x-twitter"></i>
            </span>
          </a>
          <a class="navbar-item bd-navbar-mobile-icon"
             href="https://www.youtube.com/channel/UCS4DTQ3-6xKmkVrFr8Xxc7Q"
             target="_blank">
            <span class="icon" style="color: #FF0000">
              <i class="fab fa-lg fa-youtube"></i>
            </span>
          </a>
          <button class="navbar-burger burger"
                  data-target="navMenuDocumentation"
                  id="navbarBurger">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
        <div class="navbar-menu" id="navMenuDocumentation">
          <div class="navbar-start bd-navbar-start bd-is-original"
               id="navbarStartOriginal">
            <a class="navbar-item bd-navbar-item bd-navbar-item-bulma-book bd-navbar-item-base"
               href="../../index.html#section_features">
              <span class="icon has-text-bleeding">
                <i class="fas fa-certificate"></i>
              </span>
              <span>Features</span>
            </a>
            <a class="navbar-item bd-navbar-item bd-navbar-item-love bd-navbar-item-base"
               href="../../index.html#section_download">
              <span class="icon has-text-danger">
                <i class="fas fa-download"></i>
              </span>
              <span>Download</span>
            </a>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-item bd-navbar-item bd-navbar-item-videos bd-navbar-item-base scroll">
                  <span class="icon has-text-success"><i class="fas fa-circle-play"></i></span><span>Getting started</span>
                </a>
                <div class="navbar-dropdown has-background-success-light">
                    <a href="../install.html" class="dropdown-item has-text-success-dark">
                      <span class="icon"><i class="fa fa-computer"></i></span> Installation
                    </a>
                    <a href="../first.html" class="dropdown-item has-text-success-dark">
                        <span class="icon"><i class="fa fa-play"></i></span> First execution
                    </a>
                    <a href="../tour.html" class="dropdown-item has-text-success-dark">
                      <span class="icon"><i class="fa fa-bus-simple"></i></span> Take a tour !
                    </a>
                </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-item bd-navbar-item bd-navbar-item-extensions bd-navbar-item-base scroll">
                  <span class="icon has-text-info"><i class="fas  fa-book"></i></span><span>Documentation</span>
                </a>
                <div class="navbar-dropdown has-background-info-light">
                    <a href="../modules.html" class="dropdown-item has-text-info-dark">
                      <span class="icon"><i class="fa fa-cubes"></i></span> Modules reference
                    </a>
                    <a href="../object.html" class="dropdown-item has-text-info-dark">
                        <span class="icon"><i class="fa fa-shapes"></i></span> Object oriented programming
                    </a>
                    <a href="../toolchain.html" class="dropdown-item has-text-info-dark">
                      <span class="icon"><i class="fa fa-wrench"></i></span> Toolchain documentation
                    </a>
                </div>
            </div>
            </a>
            <a class="navbar-item bd-navbar-item bd-navbar-item-expo bd-navbar-item-base"
               href="https://community.luart.org">
              <span class="icon has-text-warning">
                <i class="fas fa-comments"></i>
              </span>
              <span>Community</span>
            </a>
            <a class="navbar-item bd-navbar-item bd-navbar-item-blog bd-navbar-item-base" href="index.html">
                <span class="icon has-text-rss">
                  <i class="fas fa-graduation-cap"></i>
                </span>
                <span>Tutorials</span>
              </a>
            </div>
            <div class="navbar-dropdown has-background-info-light">
              <a href="../modules.html" class="dropdown-item has-text-info-dark">
                <span class="icon"><i class="fa fa-cubes"></i></span> Modules reference
              </a>
              <a href="../object.html" class="dropdown-item has-text-info-dark">
                  <span class="icon"><i class="fa fa-shapes"></i></span> Object oriented programming
              </a>
              <a href="../toolchain.html" class="dropdown-item has-text-info-dark">
                <span class="icon"><i class="fa fa-wrench"></i></span> Toolchain documentation
              </a>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <a class="bd-navbar-icon navbar-item"
             href="https://github.com/samyeyo"
             target="_blank">
            <span class="icon" style="color: #000000">
              <i class="fab fa-lg fa-github"></i>
            </span>
          </a>
          <a class="bd-navbar-icon navbar-item"
             href="https://twitter.com/__LuaRT__"
             target="_blank">
            <span class="icon" style="color: #000000">
              <i class="fab fa-lg fa-x-twitter"></i>
            </span>
          </a>
          <a class="bd-navbar-icon navbar-item"
             href="https://www.youtube.com/channel/UCS4DTQ3-6xKmkVrFr8Xxc7Q"
             target="_blank">
            <span class="icon" style="color: #FF0000">
              <i class="fab fa-lg fa-youtube"></i>
            </span>
          </a>
          <a class="bd-navbar-icon navbar-item"
          href="https://discord.gg/cvQV77nhfr"
          target="_blank">
         <span class="icon" style="color: #5865F2">
           <i class="fab fa-lg fa-discord"></i>
         </span>
       </a>
        </div>
      </nav>
  
  <section class="main-content columns is-centered is-fullheight" style="margin-top: 6%; margin-bottom: 4%">
    <div class="column is-7">
      <div class="card">
        <div class="card-content">
          <div class="content mb-6">
            <p class="title is-2 mb-0" style="color: #004080">How to use UTF8 strings with Lua<sup>rt</sup></p>
            <p class="mt-0 is-size-7 mb-6"><i>By Samir Tine, updated on January 2023</i></p>
            <p class="mt-6">Lua<sup>rt</sup> has native support for UTF8 strings, meaning you don't have to bother with specific modules or dependencies : just use accented characters in your Lua strings, and you're done ! In fact, this is more complex under the hood... </p>
            <h1 class="has-text-weight-light is-size-3 mt-6 mb-3">Lua strings are not strings !</h1>
            <p>Yes, you read that right. It could have been worthy of a shakespear play but when it comes to strings in Lua, it can turn into a nightmare if you don&#39;t pay attention with the true definition of what a string is...</p>
            <h2 class="is-size-6 mt-6 mb-3 has-text-link-dark">Wait, what do you mean by strings are not strings ?</h2>
            <p>In Lua, strings could have been called buffers, arrays, or even containers. Indeed strings are only <em>containers</em>. But it does not contain characters. In fact, Lua has no idea what a character is.</p>
            <h2 class="is-size-6 mt-6 mb-3 has-text-link-dark">So what a string contains ?</h2>
            <p>You may then wonder what the strings contain: they simply contain <code>bytes</code>. Strings can therefore, in Lua, contain lots of things: an image, a digitized sound, a database ... and characters too.</p>
            <p>This is where things get complicated: Lua considers that in strings, a single byte corresponds to a single character. This is fine as long as you are using single-byte encoded characters (as with ASCII encoding), with only 255 character possibilities.</p>
            <p>But in the age of the Internet, when the whole world communicates in all languages, that seems rather restrictive ! Fortunately other encodings than ASCII exist, to extend the number of usable characters: UTF8, UCS 2 LE, UCS 2 BE,...
            They allow to encode a character over several bytes.</p>
            <h2 class="has-text-weight-light is-size-3 mt-6 mb-3">Multibyte characters with standard Lua</h2>
            <p>Multibytes characters can be stored in Lua strings after all, as strings in Lua contains bytes.
            Yes, that's right. But it does not mean you can <em>use</em> them ! In fact, some functions in Lua <code>string</code> module won't work as they expect to work on single byte characters.</p>
            <h2 class="is-size-6 mt-6 mb-3 has-text-link-dark">One rule to rule them all</h2>
            <p>Lua strings functionnalities (concatenation, length calculation, <code>string.find</code>, <code>string.sub</code>...) consider that strings contain only single byte characters : the same rule again!</p>
            <p>Here is an example that illustrates the problem when using standard Lua (the script must have been saved with UTF8 encoding +/- BOM)</p>
            <div class="language-lua" style="margin-left: 20%; margin-right:20%"><code>
local summer_infrench = "été"

-- outputs 5 !?
print(string.len(summer_infrench))

-- pos = 3 !?
pos = string.find(summer_infrench, "t"))
            </code></div>
            <h2 class="is-size-6 mt-6 mb-3 has-text-link-dark">What's going on ?</h2>
            <p class="mb-5">Remember the rule : strings are considered as bytes containers. The UTF8 string <strong style="color:#EA6AC3">"été"</strong> (means "summer" in French) is 3 characters long, but occupies 5 bytes in memory :</p>
            <table style="margin-left:auto; margin-right:auto">
            <thead>
            <tr>
            <th style="text-align:center"><strong style="color:#EA6AC3">é</strong></th>
            <th style="text-align:center"><strong style="color:#EA6AC3">t</strong></th>
            <th style="text-align:center"><strong style="color:#EA6AC3">é</strong></th>
            <th style="text-align:left; padding-left:20px; color:#EA6AC3; font-weight: normal;">= 3 characters</th>
            </tr>
            </thead>
            <tbody>
            <tr>
            <td style="text-align:center"><code>0xC3 0xA9</code></td>
            <td style="width: 60px;text-align:center;"><code>0x75</code></td>
            <td style="text-align:center"><code>0xC3 0xA9</code></td>
            <td style="text-align:left; padding-left:20px; color: #ae81ff; font-weight: normal;">= 5 bytes</td>
            </tr>
            </tbody>
            </table>
            <p class="mt-5">That's why the function <code>string.len</code> returns 5 and not 3.
            The same for <code>string.find</code> : The byte position of the &quot;t&quot; character is 3.</p>
            <h2 class="has-text-weight-light is-size-3 mt-6 mb-3">The standard "utf8" module</h2>
            <p>Hopefully, yes there is a workaround. Since Lua 5.3 a new <code>uft8</code>module is available to help developers with UTF8 encoded strings. But this greatly complicates the use of UTF8 strings, as it uses specific functions. A kind of overlay over strings. Not very friendly : in other modern programming languages, strings are containers for characters and support natively multibytes encodings.</p>
            <p>Here is the previous example using the <code>utf8</code> module :</p>
            <div class="language-lua" style="margin-left: 20%; margin-right:20%"><code>
local utf8 = require "utf8"
           
local summer_infrench = "été"
            
-- yes ! outputs 3 !
print(utf8.len(summer_infrench))

-- Still pos = 3, no solution for string.find with UTF8 strings
pos = string.find(summer_infrench, "t"))
            </code></div>
            <p class="mt-5">But as you can see, this module is no help when using most of the strings pattern matching functions.</p>
            <p>If you want to use UTF8 strings with standard Lua, you will have to use a binary module dependency.</p>
            <p>It's in Lua philosophy : if Lua lacks something, implement it using binary modules or Lua modules. Search on the net and you will find some of them. But again, for such a simple functionality, this represents a certain degree of complication especially for beginners. </p>
            <h2 class="has-text-weight-light is-size-3 mt-6 mb-3">Lua</span><sup>rt</sup> and multibytes character strings</h2>
            <p>Lua<sup>rt</sup> implements UTF8 strings natively, without any other dependencies : just use accented characters in your strings. All the modules of the runtime library supports UTF8 strings.</p>
            <p>The <a href="../string/index.html"><i class="fas fa-quote-right" style="color :#B1D928; vertical-align: top"></i> string</a> module in Lua<sup>rt</sup> provides specific functions for UTF8 string manipulation, prefixed by <code>u</code>, such as finding and extracting substrings, and pattern matching.</p>
             <p>Here is the previous example with Lua<sup>rt</sup> :</p>
             <div class="language-lua" style="margin-left: 20%; margin-right:20%"><code>
-- no need for the "utf8" module
            
local summer_infrench = "été"
            
-- yes ! outputs 3 !
-- string.ulen() => string.len() for UTF8 strings
print(string.ulen(summer_infrench))

-- Yes, pos = 2 !
-- string.ufind() => string.find() for UTF8 strings
pos = string.ufind(summer_infrench, "t"))

-- You can still get string length in bytes with the # operator
-- bytelen = 5
bytelen = #summer_infrench
                          </code></div>
                           <p class="mt-5">When you use strings to store binary data, you can use the instead the <a href="../sys/Buffer.html"><i class="fas fa-th" style="color :#367DBB"></i> Buffer</a> object.</p>
        </div>
      </div>
    </div>
  </div>
  </section>  
  <footer class="footer">
    <div class="content has-text-centered">
      <p class="mb-0">
        <strong>
          Lua
          <sup>rt</sup> Documentation
        </strong> - Windows programming framework for Lua
      </p>
      <a class="is-hovered" href="https://github.com/samyeyo" target="_blank">
        <span class="icon" style="color: #A0A0A0">
          <i class="fab fa-lg fa-github"></i>
        </span>
      </a>
      <a class="is-hovered"
         href="https://twitter.com/__LuaRT__"
         target="_blank">
        <span class="icon" style="color: #A0A0A0">
          <i class="fab fa-lg fa-x-twitter"></i>
        </span>
      </a>
<a class="is-hovered"
         href="https://www.youtube.com/channel/UCS4DTQ3-6xKmkVrFr8Xxc7Q"
         target="_blank">
        <span class="icon" style="color: #A0A0A0">
          <i class="fab fa-lg fa-youtube"></i>
        </span>
      </a>      
      <a class="is-hovered"
      href="https://discord.gg/cvQV77nhfr"
      target="_blank">
     <span class="icon" style="color: #A0A0A0">
       <i class="fab fa-lg fa-discord"></i>
     </span>
     </a>    
      <p class="mt-0">
        Copyright &copy; 2024
        <a href="mailto:samir.tine@luart.org">Samir Tine</a>.
        <br />
        <a href="https://bulma.io/made-with-bulma/">
          <img alt="Made with Bulma"
               height="24"
               src="https://bulma.io/images/made-with-bulma.png"
               width="128" />
        </a>
      </p>
    </div>
  </footer>
  <script src="../../js/main.js"></script>
  <script src="../prism.js"></script>
  <script src="../custom-class.js"></script>
  <script>Prism.plugins.customClass.prefix('prism--');</script>
</body>
</html>
